&НаСервере
Функция ВыполнитьНаСервере2(ТабличныйДокумент)
	Макет = РеквизитФормыВЗначение("Объект").ПолучитьМакет("Макет1");
	ОбластьШапка = Макет.ПолучитьОбласть("Шапка");
	ОбластьПериод = Макет.ПолучитьОбласть("ДеталиГруппа");
	ОбластьТовар = Макет.ПолучитьОбласть("Детали");
	
	ТабличныйДокумент.Вывести(ОбластьШапка);
	ТабличныйДокумент.НачатьАвтогруппировкуСтрок();
	Запрос = Новый Запрос;
	Запрос.Текст =
		"ВЫБРАТЬ
				|	ВыручкаИСебестоимостьПродажОбороты.СуммаВыручкиОборот КАК СуммаВыручкиОборот,
				|	ВыручкаИСебестоимостьПродажОбороты.АналитикаУчетаПоПартнерам.Партнер КАК АналитикаУчетаПоПартнерамПартнер,
				|	ВыручкаИСебестоимостьПродажОбороты.АналитикаУчетаНоменклатуры.Номенклатура КАК АналитикаУчетаНоменклатурыНоменклатура,
				|	ВыручкаИСебестоимостьПродажОбороты.Период КАК Период
				|ИЗ
				|	РегистрНакопления.ВыручкаИСебестоимостьПродаж.Обороты(&дн, &дк, День, ) КАК ВыручкаИСебестоимостьПродажОбороты
				|
				|УПОРЯДОЧИТЬ ПО
				|	Период
				|ИТОГИ
				|	СУММА(СуммаВыручкиОборот)
				|ПО
				|	Период ПЕРИОДАМИ(ДЕНЬ, &дн, &дк)";
	
	Запрос.УстановитьПараметр("дн", Дата("20161001000000"));
	Запрос.УстановитьПараметр("дк", Дата("20161031235959"));
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыборкаПериод = РезультатЗапроса.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам, "Период", "Все");
	Пока ВыборкаПериод.Следующий() Цикл
		ОбластьПериод.Параметры.Заполнить(ВыборкаПериод);
		ТабличныйДокумент.Вывести(ОбластьПериод, ВыборкаПериод.Уровень());
		ВыборкаДетЗаписи = ВыборкаПериод.Выбрать();
		Пока ВыборкаДетЗаписи.Следующий() Цикл
			ОбластьТовар.Параметры.Заполнить(ВыборкаДетЗаписи);
			ТабличныйДокумент.Вывести(ОбластьТовар, ВыборкаДетЗаписи.Уровень());
		КонецЦикла;		
	КонецЦикла;
	ТабличныйДокумент.ЗакончитьАвтогруппировкуСтрок();
	Возврат  ТабличныйДокумент;	
КонецФункции
